<!DOCTYPE html>
<meta charset="utf-8" />

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

<!-- Create an element where the map will take place -->
<svg id="my_dataviz" width="960" height="680"></svg>

<script>
  // The svg
  var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

  // Map and projection
  var projection = d3
    .geoMercator()
    .center([0, 5])
    .scale(175)
    .rotate([-145, 0])
    .translate([width / 2, (height / 2) * 1.3]);

  // var g = svg.append("g");

  // load and display the cities
  // d3.csv("https://raw.githubusercontent.com/richarhila/map/master/cities2.csv", function(error, data) {
  //     g.selectAll("circle")
  //        .data(data)
  //        .enter()
  //        .append("a")
  // 				  .attr("xlink:href", function(d) {
  // 					  return "https://www.google.com/search?q="+d.city;}
  // 				  )
  //        .append("circle")
  //        .attr("cx", function(d) {
  //                return projection([d.Longitude, d.Latitude])[0];
  //        })
  //        .attr("cy", function(d) {
  //                return projection([d.Longitude, d.Latitude])[1];
  //        })
  //        .attr("r", 5)
  //        .style("fill", "red");
  // });
  var link = [];
  var markers = [];

  // A path generator
  var path = d3.geoPath().projection(projection);

  //     }
  //   );

  // Load city data and generate coordinates for each research institution
  d3.csv(
    "https://raw.githubusercontent.com/richarhila/map/master/cities.csv",
    function(error, cityData) {
      cityData.forEach(function(d) {
        markers.push({
          long: +d.Longitude,
          lat: +d.Latitude
        });
        let homeCoordinates = [151.1873473, -33.888584]; // Coordinates of UniSyd
        let cityCoordinates = [+d.Longitude, +d.Latitude];
        link.push({
          type: "LineString",
          coordinates: [homeCoordinates, cityCoordinates]
        });
      });
      console.log(markers);
      console.log(link);
    }
  );

  // Load world shape
  d3.json(
    "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson",
    function(error, worldData) {
      // Draw the map
      svg
        .append("g")
        .selectAll("path")
        .data(worldData.features)
        .enter()
        .append("path")
        .attr("fill", "#dddddd")
        .attr("d", path)
        .style("stroke", "#fff")
        .style("stroke-width", 0);

      // Add the path
      svg
        .selectAll("myPath")
        .data(link)
        .enter()
        .append("path")
        .attr("d", function(d) {
          return path(d);
        })
        .style("fill", "none")
        .style("stroke", "gray")
        .style("stroke-width", 1)
        .attr("stroke-opacity", 0.4);

      // Add circles:
      svg
        .selectAll("myCircles")
        .data(markers)
        .enter()
        .append("circle")
        .attr("cx", function(d) {
          return projection([d.long, d.lat])[0];
        })
        .attr("cy", function(d) {
          return projection([d.long, d.lat])[1];
        })
        .attr("r", 8)
        .style("fill", "orange")
        .attr("stroke", "white")
        .attr("stroke-width", 1)
        .attr("fill-opacity", 0.6);
    }
  );
</script>
