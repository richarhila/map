<!DOCTYPE html>
<meta charset="utf-8" />

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

<!-- Create an element where the map will take place -->
<svg id="my_dataviz" width="960" height="540"></svg>

<script>
  // The svg
  var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

  // Map and projection
  var projection = d3
    .geoMercator()
    .scale(150)
    .translate([width / 2, (height / 2) * 1.3]);

  // Create data: coordinates of start and end
  //   var link = [
  //     {type: "LineString", coordinates: [[39, -6], [139, 36]]}, // Zanzibar to Tokyo
  //     {type: "LineString", coordinates: [[175, -36], [100, 13.75]]} // Auckland to Bangkok
  //   ]

  // var g = svg.append("g");

  // load and display the cities
  // d3.csv("https://raw.githubusercontent.com/richarhila/map/master/cities2.csv", function(error, data) {
  //     g.selectAll("circle")
  //        .data(data)
  //        .enter()
  //        .append("a")
  // 				  .attr("xlink:href", function(d) {
  // 					  return "https://www.google.com/search?q="+d.city;}
  // 				  )
  //        .append("circle")
  //        .attr("cx", function(d) {
  //                return projection([d.Longitude, d.Latitude])[0];
  //        })
  //        .attr("cy", function(d) {
  //                return projection([d.Longitude, d.Latitude])[1];
  //        })
  //        .attr("r", 5)
  //        .style("fill", "red");
  // });

  // A path generator
  var path = d3.geoPath().projection(projection);

  var link = [];
  // Load world shape
  d3.json(
    "https://raw.githubusercontent.com/richarhila/map/master/world-110m2.json",
    function(error, topology) {
      // Load city data
      d3.csv(
        "https://raw.githubusercontent.com/richarhila/map/master/cities2.csv",
        function(error, data) {
          data.forEach(function(d) {
            let homeCoordinates = [151.1873473, -33.888584]; // Coordinates of UniSyd
            let cityCoordinates = [+d.Longitude, +d.Latitude];
            link.push({
              type: "LineString",
              coordinates: [homeCoordinates,
              cityCoordinates]
            });
          });
          console.log(link);
        }
      );
      // Draw the map
      // svg.append("g")
      //     .selectAll("path")
      //     .data(data.features)
      //     .enter().append("path")
      //         .attr("fill", "#b8b8b8")
      //         .attr("d", d3.geoPath()
      //             .projection(projection)
      //         )
      //         .style("stroke", "#fff")
      //         .style("stroke-width", 0)

      // Add the path
      // svg.selectAll("myPath")
      //   .data(link)
      //   .enter()
      //   .append("path")
      //     .attr("d", function(d){ return path(d)})
      //     .style("fill", "none")
      //     .style("stroke", "orange")
      //     .style("stroke-width", 2)
    }
  );
</script>
